/*!
 *
 * jQuery collagePlus Plugin v0.3.0
 * https://github.com/ed-lea/jquery-collagePlus
 *
 * Copyright 2012, Ed Lea twitter.com/ed_lea
 *
 * built for http://qiip.me
 *
 * Dual licensed under the MIT or GPL Version 2 licenses.
 * http://www.opensource.org/licenses/mit-license.php
 * http://www.opensource.org/licenses/GPL-2.0
 *
 */
;(function(e){e.fn.collagePlus=function(t){function r(t,n,r,s){var o=r.padding*(t.length-1)+t.length*t[0][3],u=r.albumWidth-o,a=u/(n-o),f=o,l=n<r.albumWidth?true:false;for(var c=0;c<t.length;c++){var h=e(t[c][0]),p=Math.floor(t[c][1]*a),d=Math.floor(t[c][2]*a),v=!!(c<t.length-1);if(r.allowPartialLastRow===true&&l===true){p=t[c][1];d=t[c][2]}f+=p;if(!v&&f<r.albumWidth){if(r.allowPartialLastRow===true&&l===true){p=p}else{p=p+(r.albumWidth-f)}}if(h.is("img")){h.width(p)}else{h.width(p+t[c][3]);h.find("img").width(p)}if(h.is("img")){h.height(d)}else{h.height(d+t[c][4]);h.find("img").height(d)}i(h,v,r);if(r.effect=="default"){h.animate({opacity:"1"},{duration:r.fadeSpeed})}else{if(r.direction=="vertical"){var m=s<=10?s:10}else{var m=c<=9?c+1:10}h.addClass(r.effect);h.addClass("effect-duration-"+m)}}}function i(e,t,n){var r={"margin-bottom":n.padding+"px","margin-right":t?n.padding+"px":"0px",display:n.display,"vertical-align":"bottom",overflow:"hidden"};return e.css(r)}function s(t){$img=e(t);var n=new Array;n["w"]=parseFloat($img.css("border-left-width"))+parseFloat($img.css("border-right-width"));n["h"]=parseFloat($img.css("border-top-width"))+parseFloat($img.css("border-bottom-width"));return n}var n=e.extend({targetHeight:400,albumWidth:this.width(),padding:parseFloat(this.css("padding-left")),images:this.children(),fadeSpeed:"fast",display:"inline-block",effect:"default",direction:"vertical",allowPartialLastRow:false},t);return this.each(function(){var t=0,i=[],o=1;n.images.each(function(u){var a=e(this),f=a.is("img")?a:e(this).find("img");var l=typeof f.data("width")!="undefined"?f.data("width"):f.width(),c=typeof f.data("height")!="undefined"?f.data("height"):f.height();var h=s(f);f.data("width",l);f.data("height",c);var p=Math.ceil(l/c*n.targetHeight),d=Math.ceil(n.targetHeight);i.push([this,p,d,h["w"],h["h"]]);t+=p+h["w"]+n.padding;if(t>n.albumWidth&&i.length!=0){r(i,t-n.padding,n,o);delete t;delete i;t=0;i=[];o+=1}if(n.images.length-1==u&&i.length!=0){r(i,t,n,o);delete t;delete i;t=0;i=[];o+=1}})})}})(jQuery);